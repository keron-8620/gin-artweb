# IP 过滤中间件实现计划

## 功能需求
- IP 黑白名单管理
- 临时封禁功能
- 作为 Gin 中间件使用

## 实现步骤

1. **添加必要的结构体和变量**
   - 创建 IP 过滤器结构体，包含白名单、黑名单和封禁列表
   - 实现线程安全的存储（使用 sync.Map 或互斥锁）

2. **实现核心功能**
   - IP 提取函数（处理 X-Forwarded-For 等代理头）
   - 白名单检查逻辑
   - 黑名单检查逻辑
   - 临时封禁检查逻辑（带过期时间）

3. **完善中间件函数**
   - 实现 IPFilterMiddleware 函数
   - 添加配置选项（如是否启用、默认策略等）
   - 实现拦截后的响应处理

4. **添加辅助方法**
   - 添加/移除白名单 IP
   - 添加/移除黑名单 IP
   - 添加/解除临时封禁
   - 清理过期的封禁记录

5. **测试和验证**
   - 确保代码符合 Go 语言规范
   - 验证中间件在 Gin 框架中的使用方式
   - 检查是否有潜在的性能问题

## 技术要点
- 使用 sync.Map 实现线程安全的 IP 存储
- 实现基于时间的封禁过期机制
- 支持从请求头中提取真实 IP（处理代理情况）
- 提供简洁的 API 接口供外部调用

## 预期输出
- 完整的 ipfilter.go 文件，包含所有必要的功能
- 可直接集成到 Gin 框架中使用的中间件
- 支持动态管理 IP 列表的方法