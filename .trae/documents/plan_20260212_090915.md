# 补全role_repo_test.go文件的单元测试计划

## 测试文件结构

根据参考的api_repo_test.go、menu_repo_test.go和button_repo_test.go文件，我将按照以下结构组织role_repo_test.go文件的测试：

1. **基础测试**：测试RoleRepo的基本CRUD操作
2. **权限策略测试**：测试AddGroupPolicy和RemoveGroupPolicy方法
3. **边界情况测试**：测试各种边界情况和错误处理
4. **上下文测试**：测试上下文超时和取消的情况
5. **关联测试**：测试与API、Menu和Button的关联操作

## 具体测试用例

### 1. 基础CRUD测试

- **TestCreateRole**：测试创建角色
- **TestUpdateRole**：测试更新角色
- **TestDeleteRole**：测试删除角色
- **TestGetRole**：测试获取单个角色
- **TestListRole**：测试获取角色列表（包括分页）

### 2. 权限策略测试

- **TestAddGroupPolicy**：测试添加角色权限策略
- **TestRemoveGroupPolicy**：测试删除角色权限策略
- **TestAddGroupPolicyWithNilRole**：测试添加权限策略时传入nil角色
- **TestAddGroupPolicyWithZeroID**：测试添加权限策略时传入ID为0的角色
- **TestRemoveGroupPolicyWithNilRole**：测试删除权限策略时传入nil角色
- **TestRemoveGroupPolicyWithZeroID**：测试删除权限策略时传入ID为0的角色

### 3. 边界情况测试

- **TestCreateRoleWithNilModel**：测试创建角色时传入nil模型
- **TestCreateRoleWithEmptyRelations**：测试创建角色时传入空的关联列表
- **TestUpdateRoleWithEmptyData**：测试更新角色时传入空数据
- **TestGetRoleWithEmptyConditions**：测试获取角色时传入空条件
- **TestGetRoleWithNonExistentID**：测试获取不存在的角色ID
- **TestDeleteRoleWithNonExistentID**：测试删除不存在的角色ID
- **TestUpdateRoleWithNonExistentID**：测试更新不存在的角色ID
- **TestListRoleWithPaginationBoundaries**：测试分页参数边界值
- **TestListRoleWithNoRecords**：测试列表查询无记录情况

### 4. 上下文测试

- **TestContextTimeout**：测试上下文超时情况
- **TestContextCancel**：测试上下文取消情况

### 5. 关联测试

- **TestCreateRoleWithApis**：测试创建与API关联的角色
- **TestCreateRoleWithMenus**：测试创建与Menu关联的角色
- **TestCreateRoleWithButtons**：测试创建与Button关联的角色
- **TestCreateRoleWithAllRelations**：测试创建与所有类型关联的角色
- **TestPreloadRelations**：测试预加载关联数据

## 实现步骤

1. **完善测试套件设置**：确保测试套件正确设置数据库迁移和依赖项
2. **实现基础CRUD测试**：为每个基本方法编写测试用例
3. **实现权限策略测试**：测试权限相关的方法
4. **实现边界情况测试**：测试各种边界情况和错误处理
5. **实现上下文测试**：测试上下文相关的情况
6. **实现关联测试**：测试与其他模型的关联操作
7. **运行测试**：确保所有测试通过

## 参考文件

- `api_repo_test.go`：参考API仓库的测试结构和方法
- `menu_repo_test.go`：参考菜单仓库的测试结构和方法
- `button_repo_test.go`：参考按钮仓库的测试结构和方法
- `role_repo.go`：参考角色仓库的实现，确保测试覆盖所有方法

## 测试覆盖范围

- 所有公开方法的正常操作
- 各种边界情况和错误处理
- 权限策略的添加和删除
- 上下文管理
- 与其他模型的关联操作

通过以上测试用例，我们将确保RoleRepo的所有功能都得到充分测试，提高代码的可靠性和可维护性。