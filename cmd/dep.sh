#!/usr/bin/env sh

# è„šæœ¬åŠŸèƒ½ï¼šå°†æœ¬æœºæŒ‡å®šç›®å½•/æ–‡ä»¶åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œæ”¯æŒè‡ªåŠ¨åˆ›å»ºç›®å½•ã€åˆ é™¤è¿œç¨‹å¤šä½™æ–‡ä»¶
set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡ºï¼Œé¿å…æ‰§è¡Œåç»­å‘½ä»¤

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ä¸Šçº§ç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
basepath=$(cd "$(dirname "$0")/.."; pwd)
cd "$basepath" || exit  # åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå¤±è´¥åˆ™é€€å‡º

# å®šä¹‰é…ç½®å˜é‡
ssh_host="192.168.11.189"
ssh_port=22
ssh_user="ansible"
remote_base_path="/home/ansible/gin-artweb"

# è¦åŒæ­¥çš„æ–‡ä»¶/ç›®å½•åˆ—è¡¨ï¼ˆç›¸å¯¹é¡¹ç›®æ ¹ç›®å½•ï¼‰
sync_items=(
    "config"
    "bin"
    ".env"
    "cmd"
    "sql"
    "resource"
)

# éå†è¦åŒæ­¥çš„é¡¹ï¼Œé€ä¸ªæ‰§è¡Œrsyncï¼ˆç¡®ä¿æ¯ä¸ªé¡¹ç‹¬ç«‹åŒæ­¥ï¼Œç›®å½•ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºï¼‰
for item in "${sync_items[@]}"; do
    # æ‰§è¡ŒrsyncåŒæ­¥
    # å‚æ•°è¯´æ˜ï¼š
    # -avzï¼šå½’æ¡£æ¨¡å¼ï¼ˆä¿ç•™å±æ€§ï¼‰+ è¯¦ç»†è¾“å‡º + å‹ç¼©ä¼ è¾“
    # -eï¼šæŒ‡å®šsshç«¯å£
    # --deleteï¼šåˆ é™¤è¿œç¨‹æ¯”æœ¬åœ°å¤šçš„æ–‡ä»¶/ç›®å½•
    # --mkdirï¼šè‡ªåŠ¨åˆ›å»ºè¿œç¨‹ä¸å­˜åœ¨çš„ç›®å½•
    rsync -avz \
        -e "ssh -p $ssh_port" \
        --delete \
        --mkdir \
        "$item" \
        "${ssh_user}@${ssh_host}:${remote_base_path}/"

    echo "âœ…  æˆåŠŸåŒæ­¥ $item åˆ° ${ssh_host}:${remote_base_path}/$item"
done

echo "ğŸ‰  æ‰€æœ‰æŒ‡å®šé¡¹åŒæ­¥å®Œæˆï¼"